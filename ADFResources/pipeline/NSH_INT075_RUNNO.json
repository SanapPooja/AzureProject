{
	"name": "NSH_INT075_RUNNO",
	"properties": {
		"activities": [
			{
				"name": "Lookup1",
				"type": "Lookup",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": {
							"value": "Select distinct top 5 run_no from dbo.tbl_scm_sts_cab_bender_download where REC_TYPE = 'Y'\t\t\t\t\t\t\t",
							"type": "Expression"
						},
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"dataset": {
						"referenceName": "SqlServerTable11",
						"type": "DatasetReference"
					},
					"firstRowOnly": false
				}
			},
			{
				"name": "Set variable1",
				"type": "SetVariable",
				"dependsOn": [
					{
						"activity": "Lookup1",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"variableName": "RunNoArray",
					"value": {
						"value": "@activity('Lookup1').output.value",
						"type": "Expression"
					}
				}
			},
			{
				"name": "ForEach1",
				"type": "ForEach",
				"dependsOn": [
					{
						"activity": "Set variable1",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"userProperties": [],
				"typeProperties": {
					"items": {
						"value": "@variables('RunNoArray')",
						"type": "Expression"
					},
					"activities": [
						{
							"name": "Set variable2",
							"type": "SetVariable",
							"dependsOn": [],
							"policy": {
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"variableName": "run_no",
								"value": {
									"value": "@item().run_no",
									"type": "Expression"
								}
							}
						},
						{
							"name": "Lookup2",
							"type": "Lookup",
							"dependsOn": [
								{
									"activity": "Set variable2",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "0.12:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"source": {
									"type": "OracleSource",
									"oracleReaderQuery": {
										"value": "SELECT COUNT(*) AS count FROM scm_admin.cab_bender_download WHERE run_no='@{variables('run_no')}'\n",
										"type": "Expression"
									},
									"partitionOption": "None",
									"convertDecimalToInteger": false,
									"queryTimeout": "02:00:00"
								},
								"dataset": {
									"referenceName": "SCM_IDB_DB",
									"type": "DatasetReference"
								},
								"firstRowOnly": false
							}
						},
						{
							"name": "Lookup5",
							"type": "Lookup",
							"dependsOn": [
								{
									"activity": "Lookup2",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "0.12:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"source": {
									"type": "SqlServerSource",
									"sqlReaderQuery": {
										"value": "select count(*) cnt from  [dbo].[tbl_scm_sts_cab_bender_download] where run_no = '@{variables('run_no')}'",
										"type": "Expression"
									},
									"queryTimeout": "02:00:00",
									"partitionOption": "None"
								},
								"dataset": {
									"referenceName": "SqlServerTable13",
									"type": "DatasetReference"
								},
								"firstRowOnly": false
							}
						},
						{
							"name": "Lookup6",
							"type": "Lookup",
							"dependsOn": [
								{
									"activity": "Lookup5",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "0.12:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"source": {
									"type": "OracleSource",
									"oracleReaderQuery": {
										"value": "select count(*) as count from scm_admin.view_cab_print_tag where run_no='H205074L0100'\n",
										"type": "Expression"
									},
									"partitionOption": "None",
									"convertDecimalToInteger": false,
									"queryTimeout": "02:00:00"
								},
								"dataset": {
									"referenceName": "SCM_IDB_DB",
									"type": "DatasetReference"
								},
								"firstRowOnly": false
							}
						},
						{
							"name": "Lookup7",
							"type": "Lookup",
							"dependsOn": [
								{
									"activity": "Lookup6",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"policy": {
								"timeout": "0.12:00:00",
								"retry": 0,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"source": {
									"type": "SqlServerSource",
									"sqlReaderQuery": {
										"value": "select count(*) as cnt from [dbo].[tbl_scm_sts_cab_print_tag] where run_no = '@{variables('run_no')}'\n",
										"type": "Expression"
									},
									"queryTimeout": "02:00:00",
									"partitionOption": "None"
								},
								"dataset": {
									"referenceName": "SqlServerTable14",
									"type": "DatasetReference"
								},
								"firstRowOnly": false
							}
						},
						{
							"name": "If Condition1",
							"type": "IfCondition",
							"dependsOn": [
								{
									"activity": "Lookup7",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"userProperties": [],
							"typeProperties": {
								"expression": {
									"value": "@and(\n    equals(activity('Lookup2').output.value[0].count, activity('Lookup5').output.value[0].cnt),\n    equals(activity('Lookup6').output.value[0].count, activity('Lookup7').output.value[0].cnt)\n)\n\n",
									"type": "Expression"
								},
								"ifTrueActivities": [
									{
										"name": "Lookup8",
										"type": "Lookup",
										"dependsOn": [],
										"policy": {
											"timeout": "0.12:00:00",
											"retry": 0,
											"retryIntervalInSeconds": 30,
											"secureOutput": false,
											"secureInput": false
										},
										"userProperties": [],
										"typeProperties": {
											"source": {
												"type": "SqlServerSource",
												"sqlReaderQuery": {
													"value": "SELECT COUNT(DISTINCT rec_type) AS rec_type \nFROM [dbo].[tbl_scm_sts_cab_bender_download] \nWHERE run_no ='@{variables('run_no')}'\n",
													"type": "Expression"
												},
												"queryTimeout": "02:00:00",
												"partitionOption": "None"
											},
											"dataset": {
												"referenceName": "SqlServerTable15",
												"type": "DatasetReference"
											},
											"firstRowOnly": false
										}
									}
								]
							}
						},
						{
							"name": "If Condition2",
							"type": "IfCondition",
							"dependsOn": [
								{
									"activity": "If Condition1",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"userProperties": [],
							"typeProperties": {
								"expression": {
									"value": "@greater(activity('Lookup8').output.value[0].rec_type, 1)\n",
									"type": "Expression"
								},
								"ifTrueActivities": [
									{
										"name": "Stored procedure1",
										"type": "SqlServerStoredProcedure",
										"dependsOn": [],
										"policy": {
											"timeout": "0.12:00:00",
											"retry": 0,
											"retryIntervalInSeconds": 30,
											"secureOutput": false,
											"secureInput": false
										},
										"userProperties": [],
										"typeProperties": {
											"storedProcedureName": "[dbo].[UpdateCabBenderDownload]",
											"storedProcedureParameters": {
												"run_no": {
													"value": "",
													"type": "String"
												}
											}
										},
										"linkedServiceName": {
											"referenceName": "NSQADB2Connection",
											"type": "LinkedServiceReference"
										}
									}
								]
							}
						},
						{
							"name": "If Condition3",
							"type": "IfCondition",
							"dependsOn": [
								{
									"activity": "If Condition1",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"userProperties": [],
							"typeProperties": {
								"expression": {
									"value": "@equals(activity('Lookup8').output.value[0].rec_type, 1)\n",
									"type": "Expression"
								},
								"ifTrueActivities": [
									{
										"name": "Lookup10",
										"type": "Lookup",
										"dependsOn": [],
										"policy": {
											"timeout": "0.12:00:00",
											"retry": 0,
											"retryIntervalInSeconds": 30,
											"secureOutput": false,
											"secureInput": false
										},
										"userProperties": [],
										"typeProperties": {
											"source": {
												"type": "SqlServerSource",
												"sqlReaderQuery": {
													"value": "SELECT B.RUN_NO, A.GROUP_TAG_ID, COUNT(2) AS CNT\nFROM [tbl_scm_sts_cab_print_tag] A\nINNER JOIN [dbo].[tbl_scm_sts_cab_bender_download] B\nON A.run_no = B.run_no\nAND A.tag_no = B.tag_no\nWHERE A.run_no = '@{variables('run_no')}'\nAND ISNULL(A.group_tag_id,'') <> ''\nAND A.group_tag_id LIKE 'C%'\nGROUP BY B.RUN_NO, A.GROUP_TAG_ID\nHAVING COUNT(A.group_tag_id) > 1;\n",
													"type": "Expression"
												},
												"queryTimeout": "02:00:00",
												"partitionOption": "None"
											},
											"dataset": {
												"referenceName": "SqlServerTable17",
												"type": "DatasetReference"
											},
											"firstRowOnly": false
										}
									}
								]
							}
						},
						{
							"name": "If Condition4",
							"type": "IfCondition",
							"dependsOn": [
								{
									"activity": "If Condition3",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"userProperties": [],
							"typeProperties": {
								"expression": {
									"value": "@greaterOrEquals(int(activity('Lookup10').output.value[0].CNT), 1)\n",
									"type": "Expression"
								},
								"ifFalseActivities": [
									{
										"name": "Lookup12",
										"type": "Lookup",
										"dependsOn": [],
										"policy": {
											"timeout": "0.12:00:00",
											"retry": 0,
											"retryIntervalInSeconds": 30,
											"secureOutput": false,
											"secureInput": false
										},
										"userProperties": [],
										"typeProperties": {
											"source": {
												"type": "SqlServerSource",
												"sqlReaderQuery": {
													"value": "SELECT tag_no,tag_qty,productbar,shapecode,prodn_len,spare1,bbs_no,barmark,\n              substring(CAST(prodn_TAG_WT AS VARCHAR(50)),1,charindex('.',CAST(prodn_TAG_WT AS VARCHAR(50)))+2),spare2,spare3,\n              pin_type =\n              case when pin_type in ('1','2') then 'S' \n              when pin_type ='3' then 'N' end               \n,pin_size,spare4,spare5,spare6,no_of_bending,spare7,run_no,spare8,\n              spare9,planduration,\nplan_machine,no_of_segments,spare12,bvbs_len,shape_bvbs_parameter+'@'\n              FROM sts.dbo.tbl_scm_sts_cab_bender_download\n              WHERE\n              run_no = '@{variables('run_no')}'\n              order by CAST ( substring(tag_no,2, len(tag_no)) as INT)",
													"type": "Expression"
												},
												"queryTimeout": "02:00:00",
												"partitionOption": "None"
											},
											"dataset": {
												"referenceName": "NSQADB2",
												"type": "DatasetReference"
											}
										}
									}
								],
								"ifTrueActivities": [
									{
										"name": "Lookup11",
										"type": "Lookup",
										"dependsOn": [],
										"policy": {
											"timeout": "0.12:00:00",
											"retry": 0,
											"retryIntervalInSeconds": 30,
											"secureOutput": false,
											"secureInput": false
										},
										"userProperties": [],
										"typeProperties": {
											"source": {
												"type": "SqlServerSource",
												"sqlReaderQuery": {
													"value": "SELECT tag_no,\t\t\t\t\t\t\n  tag_qty,\t\t\t\t\t\t\n  productbar,\t\t\t\t\t\t\n  shapecode,\t\t\t\t\t\t\n  prodn_len,\t\t\t\t\t\t\n  spare1,\t\t\t\t\t\t\n  bbs_no,\t\t\t\t\t\t\n  barmark,\t\t\t\t\t\t\n  prodn_TAG_WT,\t\t\t\t\t\t\n  spare2,\t\t\t\t\t\t\n  spare3,\t\t\t\t\t\t\n  pin_type,\t\t\t\t\t\t\n  pin_size,\t\t\t\t\t\t\n  spare4,\t\t\t\t\t\t\n  spare5,\t\t\t\t\t\t\n  spare6,\t\t\t\t\t\t\n  no_of_bending,\t\t\t\t\t\t\n  spare7,\t\t\t\t\t\t\n  run_no,\t\t\t\t\t\t\n  spare8,\t\t\t\t\t\t\n  spare9,\t\t\t\t\t\t\n  planduration,\t\t\t\t\t\t\n  plan_machine,\t\t\t\t\t\t\n  no_of_segments,\t\t\t\t\t\t\n  spare12,\t\t\t\t\t\t\n  bvbs_len,\t\t\t\t\t\t\n  shape_bvbs_parameter\t\t\t\t\t\t\nFROM (\t\t\t\t\t\t\n  (SELECT tag_no,\t\t\t\t\t\t\n    tag_qty,\t\t\t\t\t\t\n    productbar,\t\t\t\t\t\t\n    shapecode,\t\t\t\t\t\t\n    prodn_len,\t\t\t\t\t\t\n    spare1,\t\t\t\t\t\t\n    bbs_no,\t\t\t\t\t\t\n    barmark,\t\t\t\t\t\t\n    substring(CAST(prodn_TAG_WT AS VARCHAR(50)),1,charindex('.',CAST(prodn_TAG_WT AS VARCHAR(50)))+2) prodn_tag_wt,\t\t\t\t\t\t\n    spare2,\t\t\t\t\t\t\n    spare3,\t\t\t\t\t\t\n    pin_type =\t\t\t\t\t\t\n    CASE\t\t\t\t\t\t\n      WHEN pin_type IN ('1','2')\t\t\t\t\t\t\n      THEN 'S'\t\t\t\t\t\t\n      WHEN pin_type ='3'\t\t\t\t\t\t\n      THEN 'N'\t\t\t\t\t\t\n    END ,\t\t\t\t\t\t\n    pin_size,\t\t\t\t\t\t\n    spare4,\t\t\t\t\t\t\n    spare5,\t\t\t\t\t\t\n    spare6,\t\t\t\t\t\t\n    no_of_bending,\t\t\t\t\t\t\n    spare7,\t\t\t\t\t\t\n    run_no,\t\t\t\t\t\t\n    spare8,\t\t\t\t\t\t\n    spare9,\t\t\t\t\t\t\n    planduration,\t\t\t\t\t\t\n    plan_machine,\t\t\t\t\t\t\n    no_of_segments,\t\t\t\t\t\t\n    spare12,\t\t\t\t\t\t\n    bvbs_len,\t\t\t\t\t\t\n    shape_bvbs_parameter+'@' shape_bvbs_parameter\t\t\t\t\t\t\n  FROM sts.dbo.tbl_scm_sts_cab_bender_download\t\t\t\t\t\t\n  WHERE run_no    = '@{variables('run_no')}'\t\t\t\t\t\n  AND tag_no NOT IN (\t\t\t\t\t\t\n    (SELECT d.tag_no\t\t\t\t\t\t\n    FROM\t\t\t\t\t\t\n      (SELECT B.RUN_NO,\t\t\t\t\t\t\n        A.GROUP_TAG_ID,\t\t\t\t\t\t\n        SUM(b.prodn_tag_wt) PRODN_TAG_WT,\t\t\t\t\t\t\n        SUM(b.PLANDURATION) PLANDURATION,\t\t\t\t\t\t\n        SUM(A.TAG_QTY) TAG_QTY,\t\t\t\t\t\t\n        COUNT(2) CNT\t\t\t\t\t\t\n      FROM [tbl_scm_sts_cab_print_tag] a\t\t\t\t\t\t\n      INNER JOIN [DBO].[tbl_scm_sts_cab_bender_download] b\t\t\t\t\t\t\n      ON a.run_no                    = b.run_no\t\t\t\t\t\t\n      AND a.tag_no                   = b.tag_no\t\t\t\t\t\t\n      WHERE a.run_no                 = '@{variables('run_no')}'\t\t\t\t\t\t\n      AND isnull(a.group_tag_id,'') <> ''\t\t\t\t\t\t\n      AND group_tag_id LIKE 'C%'\t\t\t\t\t\t\n      GROUP BY B.RUN_NO,\t\t\t\t\t\t\n        A.GROUP_TAG_ID\t\t\t\t\t\t\n      HAVING (COUNT(GROUP_TAG_ID) >1\t\t\t\t\t\t\n      OR COUNT(GROUP_TAG_ID)      =1 )\t\t\t\t\t\t\n      ) AS c\t\t\t\t\t\t\n    LEFT OUTER JOIN [tbl_scm_sts_cab_print_tag] d\t\t\t\t\t\t\n    ON c.run_no        = d.run_no\t\t\t\t\t\t\n    AND c.group_tag_id = d.group_tag_id\t\t\t\t\t\t\n    ) )\t\t\t\t\t\t\n  )\t\t\t\t\t\t\nUNION\t\t\t\t\t\t\n SELECT DISTINCT e.tag_no,\t\t\t\t\t\t\n    e.tag_qty,\t\t\t\t\t\t\n    b.grade_dia productbar,\t\t\t\t\t\t\n    e.shapecode,\t\t\t\t\t\t\n    e.prodn_len,\t\t\t\t\t\t\n    e.spare1,\t\t\t\t\t\t\n    B.bbs_no,\t\t\t\t\t\t\n    e.barmark,\t\t\t\t\t\t\n    e.prodn_tag_wt,\t\t\t\t\t\t\n    e.spare2,\t\t\t\t\t\t\n    e.spare3,\t\t\t\t\t\t\n    pin_type =\t\t\t\t\t\t\n    CASE\t\t\t\t\t\t\n      WHEN a.pin_type IN ('1','2')\t\t\t\t\t\t\n      THEN 'S'\t\t\t\t\t\t\n      WHEN a.pin_type ='3'\t\t\t\t\t\t\n      THEN 'N'\t\t\t\t\t\t\n    END ,\t\t\t\t\t\t\n    b.pin_size,\t\t\t\t\t\t\n    e.spare4,\t\t\t\t\t\t\n    e.spare5,\t\t\t\t\t\t\n    e.spare6,\t\t\t\t\t\t\n    e.no_of_bending,\t\t\t\t\t\t\n    e.spare7,\t\t\t\t\t\t\n    a.run_no,\t\t\t\t\t\t\n    e.spare8,\t\t\t\t\t\t\n    e.spare9,\t\t\t\t\t\t\n    e.planduration,\t\t\t\t\t\t\n    b.workcenter plan_machine,\t\t\t\t\t\t\n    e.no_of_segments,\t\t\t\t\t\t\n    e.spare12,\t\t\t\t\t\t\n    e.bvbs_len,\t\t\t\t\t\t\n    b.bvbs+'@' shape_bvbs_parameter\t\t\t\t\t\t\n  FROM sts.dbo.tbl_scm_sts_cab_bender_download a\t\t\t\t\t\t\n  INNER JOIN sts.dbo.tbl_scm_sts_cab_print_tag b\t\t\t\t\t\t\n  ON a.run_no = b.run_no\t\t\t\t\t\t\n  INNER JOIN\t\t\t\t\t\t\n    (SELECT DISTINCT c.RUN_NO,\t\t\t\t\t\t\n      c.PRODN_TAG_WT,\t\t\t\t\t\t\n      c.PLANDURATION,\t\t\t\t\t\t\n      c.TAG_QTY,\t\t\t\t\t\t\n      d.group_tag_id,\t\t\t\t\t\t\n      c.bvbs_len,\t\t\t\t\t\t\n      c.prodn_len,\t\t\t\t\t\t\n      c.shapecode,\t\t\t\t\t\t\n      c.barmark,\t\t\t\t\t\t\n\t  c.spare1,c.spare2,c.spare3,c.spare4,c.spare5,c.spare6,c.spare7,c.spare8,c.spare9,c.spare12,\t\t\t\t\t\n      c.no_of_segments,\t\t\t\t\t\t\n      c.no_of_bending,\t\t\t\t\t\t\n      TAG_NO =\t\t\t\t\t\t\n      CASE\t\t\t\t\t\t\n        WHEN CNT = '1'\t\t\t\t\t\t\n        THEN d.TAG_NO\t\t\t\t\t\t\n        WHEN CNT > '1'\t\t\t\t\t\t\n        THEN d.GROUP_TAG_ID\t\t\t\t\t\t\n      END\t\t\t\t\t\t\n     FROM\t\t\t\t\t\t\n\t\t(select run_no,group_tag_id,bvbs_len,shapecode,barmark,no_of_segments,no_of_bending,spare1,spare2,spare3,\t\t\t\t\n\t\t\tspare4,spare5,spare6,spare7,spare8,spare9,spare12,prodn_tag_wt1 as prodn_tag_wt, prodn_tag_wt1 as prodn_tag,planduration,\t\t\t\n\t\t\ttag_qty1 as tag_qty,\t\t\t\n\t\t\tprodn_len,cnt from (\t\t\t\n\t\t\tselect \t\t\t\n\t\t\trun_no,group_tag_id,bvbs_len,shapecode,barmark,no_of_segments,no_of_bending,spare1,spare2,spare3,\t\t\t\n\t\t\tspare4,spare5,spare6,spare7,spare8,spare9,spare12,prodn_tag_wt,planduration,tag_qty,\t\t\t\n\t\t\tprodn_len,cnt,row_number() over (partition by run_no,group_tag_id order by run_no,group_tag_id) as num,\t\t\t\n\t\t\tsum(planduration) over(partition by run_no,group_tag_id) as planduration1,\t\t\t\n\t\t\tsum(prodn_tag_wt) over(partition by run_no,group_tag_id) as prodn_tag_wt1,\t\t\t\n\t\t\tsum(tag_qty) over(partition by run_no,group_tag_id) as tag_qty1\t\t\t\n\t\t\tfrom \t\t\t\n\t\t\t(SELECT B.RUN_NO,\t\t\t\n\t\t\t\tA.GROUP_TAG_ID,\t\t\n\t\t\t\tb.bvbs_len,\t\t\n\t\t\t\tb.Shapecode,\t\t\n\t\t\t\tb.barmark,\t\t\n\t\t\t\tb.no_of_segments,\t\t\n\t\t\t\tb.no_of_bending,\t\t\n\t\t\t\tb.spare1,b.spare2,b.spare3,b.spare4,b.spare5,b.spare6,b.spare7,b.spare8,b.spare9,b.spare12,\t\t\n\t\t\t\tSUM(b.prodn_tag_wt) PRODN_TAG_WT,\t\t\n\t\t\t\tSUM(b.PLANDURATION) PLANDURATION,\t\t\n\t\t\t\tSUM(A.TAG_QTY) TAG_QTY,\t\t\n\t\t\t\tb.prodn_len PRODN_LEN,\t\t\n\t\t\t\tCOUNT(2) CNT\t\t\n\t\t\t  FROM [tbl_scm_sts_cab_print_tag] a\t\t\t\n\t\t\t  INNER JOIN [DBO].[tbl_scm_sts_cab_bender_download] b\t\t\t\n\t\t\t  ON a.run_no                    = b.run_no\t\t\t\n\t\t\t  AND a.tag_no                   = b.tag_no\t\t\t\n\t\t\t  WHERE a.run_no                 = '@{variables('run_no')}'\t\t\t\n\t\t\t  AND isnull(a.group_tag_id,'') <> ''\t\t\t\n\t\t\t  AND group_tag_id LIKE 'C%'\t\t\t\n\t\t\t  GROUP BY B.RUN_NO,\t\t\t\n\t\t\t\tA.GROUP_TAG_ID,\t\t\n\t\t\t\tb.bvbs_len,\t\t\n\t\t\t\tb.prodn_len,\t\t\n\t\t\t\tb.shapecode,\t\t\n\t\t\t\tb.barmark,\t\t\n\t\t\t\tb.no_of_segments,\t\t\n\t\t\t\tb.no_of_bending,\t\t\n\t\t\t\tb.spare1,b.spare2,b.spare3,b.spare4,b.spare5,b.spare6,b.spare7,b.spare8,b.spare9,b.spare12\t\t\n\t\t\t  HAVING (COUNT(GROUP_TAG_ID) >1\t\t\t\n\t\t\t  OR COUNT(GROUP_TAG_ID)      =1 )) as temp ) as inn where num = 1\t\t\t\n\t\t) AS c\t\t\t\t\n\t\t\tLEFT OUTER JOIN [tbl_scm_sts_cab_print_tag] d\t\t\t\n\t\t\tON c.run_no              = d.run_no\t\t\t\n\t\t\tAND c.group_tag_id       = d.group_tag_id\t\t\t\n    ) AS e ON e.group_tag_id = b.tag_no\t\t\t\t\t\t\n  AND b.group_tag_ind        = 'Y') AS tblMain\t\t\t\t\t\t\nORDER BY CAST ( substring(tag_no,2, LEN(tag_no)) AS INT)\t",
													"type": "Expression"
												},
												"queryTimeout": "02:00:00",
												"partitionOption": "None"
											},
											"dataset": {
												"referenceName": "NSQADB2",
												"type": "DatasetReference"
											}
										}
									}
								]
							}
						},
						{
							"name": "If Condition5",
							"type": "IfCondition",
							"dependsOn": [
								{
									"activity": "If Condition4",
									"dependencyConditions": [
										"Succeeded"
									]
								}
							],
							"userProperties": [],
							"typeProperties": {
								"expression": {
									"value": "@greater(length(activity('Lookup11').output.value), 1)\n",
									"type": "Expression"
								},
								"ifTrueActivities": [
									{
										"name": "Copy data3",
										"type": "Copy",
										"dependsOn": [],
										"policy": {
											"timeout": "0.12:00:00",
											"retry": 0,
											"retryIntervalInSeconds": 30,
											"secureOutput": false,
											"secureInput": false
										},
										"userProperties": [],
										"typeProperties": {
											"source": {
												"type": "SqlServerSource",
												"sqlReaderQuery": {
													"value": "SELECT tag_no,\t\t\t\t\t\t\n  tag_qty,\t\t\t\t\t\t\n  productbar,\t\t\t\t\t\t\n  shapecode,\t\t\t\t\t\t\n  prodn_len,\t\t\t\t\t\t\n  spare1,\t\t\t\t\t\t\n  bbs_no,\t\t\t\t\t\t\n  barmark,\t\t\t\t\t\t\n  prodn_TAG_WT,\t\t\t\t\t\t\n  spare2,\t\t\t\t\t\t\n  spare3,\t\t\t\t\t\t\n  pin_type,\t\t\t\t\t\t\n  pin_size,\t\t\t\t\t\t\n  spare4,\t\t\t\t\t\t\n  spare5,\t\t\t\t\t\t\n  spare6,\t\t\t\t\t\t\n  no_of_bending,\t\t\t\t\t\t\n  spare7,\t\t\t\t\t\t\n  run_no,\t\t\t\t\t\t\n  spare8,\t\t\t\t\t\t\n  spare9,\t\t\t\t\t\t\n  planduration,\t\t\t\t\t\t\n  plan_machine,\t\t\t\t\t\t\n  no_of_segments,\t\t\t\t\t\t\n  spare12,\t\t\t\t\t\t\n  bvbs_len,\t\t\t\t\t\t\n  shape_bvbs_parameter\t\t\t\t\t\t\nFROM (\t\t\t\t\t\t\n  (SELECT tag_no,\t\t\t\t\t\t\n    tag_qty,\t\t\t\t\t\t\n    productbar,\t\t\t\t\t\t\n    shapecode,\t\t\t\t\t\t\n    prodn_len,\t\t\t\t\t\t\n    spare1,\t\t\t\t\t\t\n    bbs_no,\t\t\t\t\t\t\n    barmark,\t\t\t\t\t\t\n    substring(CAST(prodn_TAG_WT AS VARCHAR(50)),1,charindex('.',CAST(prodn_TAG_WT AS VARCHAR(50)))+2) prodn_tag_wt,\t\t\t\t\t\t\n    spare2,\t\t\t\t\t\t\n    spare3,\t\t\t\t\t\t\n    pin_type =\t\t\t\t\t\t\n    CASE\t\t\t\t\t\t\n      WHEN pin_type IN ('1','2')\t\t\t\t\t\t\n      THEN 'S'\t\t\t\t\t\t\n      WHEN pin_type ='3'\t\t\t\t\t\t\n      THEN 'N'\t\t\t\t\t\t\n    END ,\t\t\t\t\t\t\n    pin_size,\t\t\t\t\t\t\n    spare4,\t\t\t\t\t\t\n    spare5,\t\t\t\t\t\t\n    spare6,\t\t\t\t\t\t\n    no_of_bending,\t\t\t\t\t\t\n    spare7,\t\t\t\t\t\t\n    run_no,\t\t\t\t\t\t\n    spare8,\t\t\t\t\t\t\n    spare9,\t\t\t\t\t\t\n    planduration,\t\t\t\t\t\t\n    plan_machine,\t\t\t\t\t\t\n    no_of_segments,\t\t\t\t\t\t\n    spare12,\t\t\t\t\t\t\n    bvbs_len,\t\t\t\t\t\t\n    shape_bvbs_parameter+'@' shape_bvbs_parameter\t\t\t\t\t\t\n  FROM sts.dbo.tbl_scm_sts_cab_bender_download\t\t\t\t\t\t\n  WHERE run_no    = '@{variables('run_no')}'\t\t\t\t\t\n  AND tag_no NOT IN (\t\t\t\t\t\t\n    (SELECT d.tag_no\t\t\t\t\t\t\n    FROM\t\t\t\t\t\t\n      (SELECT B.RUN_NO,\t\t\t\t\t\t\n        A.GROUP_TAG_ID,\t\t\t\t\t\t\n        SUM(b.prodn_tag_wt) PRODN_TAG_WT,\t\t\t\t\t\t\n        SUM(b.PLANDURATION) PLANDURATION,\t\t\t\t\t\t\n        SUM(A.TAG_QTY) TAG_QTY,\t\t\t\t\t\t\n        COUNT(2) CNT\t\t\t\t\t\t\n      FROM [tbl_scm_sts_cab_print_tag] a\t\t\t\t\t\t\n      INNER JOIN [DBO].[tbl_scm_sts_cab_bender_download] b\t\t\t\t\t\t\n      ON a.run_no                    = b.run_no\t\t\t\t\t\t\n      AND a.tag_no                   = b.tag_no\t\t\t\t\t\t\n      WHERE a.run_no                 = '@{variables('run_no')}'\t\t\t\t\t\t\n      AND isnull(a.group_tag_id,'') <> ''\t\t\t\t\t\t\n      AND group_tag_id LIKE 'C%'\t\t\t\t\t\t\n      GROUP BY B.RUN_NO,\t\t\t\t\t\t\n        A.GROUP_TAG_ID\t\t\t\t\t\t\n      HAVING (COUNT(GROUP_TAG_ID) >1\t\t\t\t\t\t\n      OR COUNT(GROUP_TAG_ID)      =1 )\t\t\t\t\t\t\n      ) AS c\t\t\t\t\t\t\n    LEFT OUTER JOIN [tbl_scm_sts_cab_print_tag] d\t\t\t\t\t\t\n    ON c.run_no        = d.run_no\t\t\t\t\t\t\n    AND c.group_tag_id = d.group_tag_id\t\t\t\t\t\t\n    ) )\t\t\t\t\t\t\n  )\t\t\t\t\t\t\nUNION\t\t\t\t\t\t\n SELECT DISTINCT e.tag_no,\t\t\t\t\t\t\n    e.tag_qty,\t\t\t\t\t\t\n    b.grade_dia productbar,\t\t\t\t\t\t\n    e.shapecode,\t\t\t\t\t\t\n    e.prodn_len,\t\t\t\t\t\t\n    e.spare1,\t\t\t\t\t\t\n    B.bbs_no,\t\t\t\t\t\t\n    e.barmark,\t\t\t\t\t\t\n    e.prodn_tag_wt,\t\t\t\t\t\t\n    e.spare2,\t\t\t\t\t\t\n    e.spare3,\t\t\t\t\t\t\n    pin_type =\t\t\t\t\t\t\n    CASE\t\t\t\t\t\t\n      WHEN a.pin_type IN ('1','2')\t\t\t\t\t\t\n      THEN 'S'\t\t\t\t\t\t\n      WHEN a.pin_type ='3'\t\t\t\t\t\t\n      THEN 'N'\t\t\t\t\t\t\n    END ,\t\t\t\t\t\t\n    b.pin_size,\t\t\t\t\t\t\n    e.spare4,\t\t\t\t\t\t\n    e.spare5,\t\t\t\t\t\t\n    e.spare6,\t\t\t\t\t\t\n    e.no_of_bending,\t\t\t\t\t\t\n    e.spare7,\t\t\t\t\t\t\n    a.run_no,\t\t\t\t\t\t\n    e.spare8,\t\t\t\t\t\t\n    e.spare9,\t\t\t\t\t\t\n    e.planduration,\t\t\t\t\t\t\n    b.workcenter plan_machine,\t\t\t\t\t\t\n    e.no_of_segments,\t\t\t\t\t\t\n    e.spare12,\t\t\t\t\t\t\n    e.bvbs_len,\t\t\t\t\t\t\n    b.bvbs+'@' shape_bvbs_parameter\t\t\t\t\t\t\n  FROM sts.dbo.tbl_scm_sts_cab_bender_download a\t\t\t\t\t\t\n  INNER JOIN sts.dbo.tbl_scm_sts_cab_print_tag b\t\t\t\t\t\t\n  ON a.run_no = b.run_no\t\t\t\t\t\t\n  INNER JOIN\t\t\t\t\t\t\n    (SELECT DISTINCT c.RUN_NO,\t\t\t\t\t\t\n      c.PRODN_TAG_WT,\t\t\t\t\t\t\n      c.PLANDURATION,\t\t\t\t\t\t\n      c.TAG_QTY,\t\t\t\t\t\t\n      d.group_tag_id,\t\t\t\t\t\t\n      c.bvbs_len,\t\t\t\t\t\t\n      c.prodn_len,\t\t\t\t\t\t\n      c.shapecode,\t\t\t\t\t\t\n      c.barmark,\t\t\t\t\t\t\n\t  c.spare1,c.spare2,c.spare3,c.spare4,c.spare5,c.spare6,c.spare7,c.spare8,c.spare9,c.spare12,\t\t\t\t\t\n      c.no_of_segments,\t\t\t\t\t\t\n      c.no_of_bending,\t\t\t\t\t\t\n      TAG_NO =\t\t\t\t\t\t\n      CASE\t\t\t\t\t\t\n        WHEN CNT = '1'\t\t\t\t\t\t\n        THEN d.TAG_NO\t\t\t\t\t\t\n        WHEN CNT > '1'\t\t\t\t\t\t\n        THEN d.GROUP_TAG_ID\t\t\t\t\t\t\n      END\t\t\t\t\t\t\n     FROM\t\t\t\t\t\t\n\t\t(select run_no,group_tag_id,bvbs_len,shapecode,barmark,no_of_segments,no_of_bending,spare1,spare2,spare3,\t\t\t\t\n\t\t\tspare4,spare5,spare6,spare7,spare8,spare9,spare12,prodn_tag_wt1 as prodn_tag_wt, prodn_tag_wt1 as prodn_tag,planduration,\t\t\t\n\t\t\ttag_qty1 as tag_qty,\t\t\t\n\t\t\tprodn_len,cnt from (\t\t\t\n\t\t\tselect \t\t\t\n\t\t\trun_no,group_tag_id,bvbs_len,shapecode,barmark,no_of_segments,no_of_bending,spare1,spare2,spare3,\t\t\t\n\t\t\tspare4,spare5,spare6,spare7,spare8,spare9,spare12,prodn_tag_wt,planduration,tag_qty,\t\t\t\n\t\t\tprodn_len,cnt,row_number() over (partition by run_no,group_tag_id order by run_no,group_tag_id) as num,\t\t\t\n\t\t\tsum(planduration) over(partition by run_no,group_tag_id) as planduration1,\t\t\t\n\t\t\tsum(prodn_tag_wt) over(partition by run_no,group_tag_id) as prodn_tag_wt1,\t\t\t\n\t\t\tsum(tag_qty) over(partition by run_no,group_tag_id) as tag_qty1\t\t\t\n\t\t\tfrom \t\t\t\n\t\t\t(SELECT B.RUN_NO,\t\t\t\n\t\t\t\tA.GROUP_TAG_ID,\t\t\n\t\t\t\tb.bvbs_len,\t\t\n\t\t\t\tb.Shapecode,\t\t\n\t\t\t\tb.barmark,\t\t\n\t\t\t\tb.no_of_segments,\t\t\n\t\t\t\tb.no_of_bending,\t\t\n\t\t\t\tb.spare1,b.spare2,b.spare3,b.spare4,b.spare5,b.spare6,b.spare7,b.spare8,b.spare9,b.spare12,\t\t\n\t\t\t\tSUM(b.prodn_tag_wt) PRODN_TAG_WT,\t\t\n\t\t\t\tSUM(b.PLANDURATION) PLANDURATION,\t\t\n\t\t\t\tSUM(A.TAG_QTY) TAG_QTY,\t\t\n\t\t\t\tb.prodn_len PRODN_LEN,\t\t\n\t\t\t\tCOUNT(2) CNT\t\t\n\t\t\t  FROM [tbl_scm_sts_cab_print_tag] a\t\t\t\n\t\t\t  INNER JOIN [DBO].[tbl_scm_sts_cab_bender_download] b\t\t\t\n\t\t\t  ON a.run_no                    = b.run_no\t\t\t\n\t\t\t  AND a.tag_no                   = b.tag_no\t\t\t\n\t\t\t  WHERE a.run_no                 = '@{variables('run_no')}'\t\t\t\n\t\t\t  AND isnull(a.group_tag_id,'') <> ''\t\t\t\n\t\t\t  AND group_tag_id LIKE 'C%'\t\t\t\n\t\t\t  GROUP BY B.RUN_NO,\t\t\t\n\t\t\t\tA.GROUP_TAG_ID,\t\t\n\t\t\t\tb.bvbs_len,\t\t\n\t\t\t\tb.prodn_len,\t\t\n\t\t\t\tb.shapecode,\t\t\n\t\t\t\tb.barmark,\t\t\n\t\t\t\tb.no_of_segments,\t\t\n\t\t\t\tb.no_of_bending,\t\t\n\t\t\t\tb.spare1,b.spare2,b.spare3,b.spare4,b.spare5,b.spare6,b.spare7,b.spare8,b.spare9,b.spare12\t\t\n\t\t\t  HAVING (COUNT(GROUP_TAG_ID) >1\t\t\t\n\t\t\t  OR COUNT(GROUP_TAG_ID)      =1 )) as temp ) as inn where num = 1\t\t\t\n\t\t) AS c\t\t\t\t\n\t\t\tLEFT OUTER JOIN [tbl_scm_sts_cab_print_tag] d\t\t\t\n\t\t\tON c.run_no              = d.run_no\t\t\t\n\t\t\tAND c.group_tag_id       = d.group_tag_id\t\t\t\n    ) AS e ON e.group_tag_id = b.tag_no\t\t\t\t\t\t\n  AND b.group_tag_ind        = 'Y') AS tblMain\t\t\t\t\t\t\nORDER BY CAST ( substring(tag_no,2, LEN(tag_no)) AS INT)\t",
													"type": "Expression"
												},
												"queryTimeout": "02:00:00",
												"partitionOption": "None"
											},
											"sink": {
												"type": "DelimitedTextSink",
												"storeSettings": {
													"type": "FileServerWriteSettings",
													"copyBehavior": "PreserveHierarchy"
												},
												"formatSettings": {
													"type": "DelimitedTextWriteSettings",
													"maxRowsPerFile": 10000,
													"fileNamePrefix": {
														"value": "'@{variables('run_no')}'",
														"type": "Expression"
													},
													"quoteAllText": true,
													"fileExtension": ".txt"
												}
											},
											"enableStaging": false,
											"translator": {
												"type": "TabularTranslator",
												"mappings": [
													{
														"source": {
															"name": "tag_no",
															"type": "String",
															"physicalType": "nvarchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 1
														}
													},
													{
														"source": {
															"name": "tag_qty",
															"type": "Decimal",
															"physicalType": "decimal",
															"scale": 0,
															"precision": 38
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 2
														}
													},
													{
														"source": {
															"name": "productbar",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 3
														}
													},
													{
														"source": {
															"name": "shapecode",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 4
														}
													},
													{
														"source": {
															"name": "prodn_len",
															"type": "Decimal",
															"physicalType": "decimal",
															"scale": 0,
															"precision": 10
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 5
														}
													},
													{
														"source": {
															"name": "spare1",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 6
														}
													},
													{
														"source": {
															"name": "bbs_no",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 7
														}
													},
													{
														"source": {
															"name": "barmark",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 8
														}
													},
													{
														"source": {
															"name": "prodn_TAG_WT",
															"type": "Decimal",
															"physicalType": "decimal",
															"scale": 9,
															"precision": 38
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 9
														}
													},
													{
														"source": {
															"name": "spare2",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 10
														}
													},
													{
														"source": {
															"name": "spare3",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 11
														}
													},
													{
														"source": {
															"name": "pin_type",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 12
														}
													},
													{
														"source": {
															"name": "pin_size",
															"type": "Decimal",
															"physicalType": "decimal",
															"scale": 0,
															"precision": 10
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 13
														}
													},
													{
														"source": {
															"name": "spare4",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 14
														}
													},
													{
														"source": {
															"name": "spare5",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 15
														}
													},
													{
														"source": {
															"name": "spare6",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 16
														}
													},
													{
														"source": {
															"name": "no_of_bending",
															"type": "Decimal",
															"physicalType": "decimal",
															"scale": 0,
															"precision": 10
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 17
														}
													},
													{
														"source": {
															"name": "spare7",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 18
														}
													},
													{
														"source": {
															"name": "run_no",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 19
														}
													},
													{
														"source": {
															"name": "spare8",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 20
														}
													},
													{
														"source": {
															"name": "spare9",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 21
														}
													},
													{
														"source": {
															"name": "planduration",
															"type": "Decimal",
															"physicalType": "decimal",
															"scale": 0,
															"precision": 38
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 22
														}
													},
													{
														"source": {
															"name": "plan_machine",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 23
														}
													},
													{
														"source": {
															"name": "no_of_segments",
															"type": "Decimal",
															"physicalType": "decimal",
															"scale": 0,
															"precision": 10
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 24
														}
													},
													{
														"source": {
															"name": "spare12",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 25
														}
													},
													{
														"source": {
															"name": "bvbs_len",
															"type": "Decimal",
															"physicalType": "decimal",
															"scale": 0,
															"precision": 10
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 26
														}
													},
													{
														"source": {
															"name": "shape_bvbs_parameter",
															"type": "String",
															"physicalType": "varchar"
														},
														"sink": {
															"type": "String",
															"physicalType": "String",
															"ordinal": 27
														}
													}
												],
												"typeConversion": true,
												"typeConversionSettings": {
													"allowDataTruncation": true,
													"treatBooleanAsNumber": false
												}
											}
										},
										"inputs": [
											{
												"referenceName": "SqlServerTable20",
												"type": "DatasetReference"
											}
										],
										"outputs": [
											{
												"referenceName": "NSH_INT075_Bendfiletxt",
												"type": "DatasetReference"
											}
										]
									},
									{
										"name": "Stored procedure2",
										"type": "SqlServerStoredProcedure",
										"dependsOn": [
											{
												"activity": "Copy data3",
												"dependencyConditions": [
													"Succeeded"
												]
											}
										],
										"policy": {
											"timeout": "0.12:00:00",
											"retry": 0,
											"retryIntervalInSeconds": 30,
											"secureOutput": false,
											"secureInput": false
										},
										"userProperties": [],
										"typeProperties": {
											"storedProcedureName": "[dbo].[UpdateCabBenderDownload2]",
											"storedProcedureParameters": {
												"run_no": {
													"value": "",
													"type": "String"
												}
											}
										},
										"linkedServiceName": {
											"referenceName": "NSQADB2Connection",
											"type": "LinkedServiceReference"
										}
									}
								]
							}
						}
					]
				}
			}
		],
		"variables": {
			"run_no": {
				"type": "String"
			},
			"run_no_arr": {
				"type": "Array"
			},
			"IDBRunCnt": {
				"type": "String"
			},
			"STSRunCnt": {
				"type": "Integer"
			},
			"IDBRunCont": {
				"type": "Integer"
			},
			"RunNo": {
				"type": "String"
			},
			"RunNoArr": {
				"type": "Array"
			},
			"RunNoCheck": {
				"type": "Boolean"
			},
			"RunNoArray": {
				"type": "Array"
			},
			"r_no": {
				"type": "String"
			}
		},
		"annotations": []
	}
}